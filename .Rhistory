#PCoA plot with fit of environmental vectors
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
points(pcoa_plot.20, col = cols, pch = 16)
#PCoA plot with fit of environmental vectors
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))+
points(pcoa_plot.20, col = cols, pch = 16)
#PCoA plot with fit of environmental vectors
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))+
points(pcoa_plot.20, col = cols, pch = 16)
groups<- factor(c('DietrichEast', 'DietrichWest', 'Dunnabeck', 'FrensNorth', 'FrensSouth', 'KlenkEast',
'KlenkWest', 'Kropf', 'Rasch', 'RaschBigRock', 'RaschSouthofHouse', 'RoosinckPatterson','RoosinckReeman', 'RothNorth','RothSouth', 'SchwetzerBlock1,Zone15', 'SchwetzerBlock2,Zone3', 'Thome','Vinton(Schwallier)','Wells'))
plot(env_fit.20, p.max=NULL, col="red")
otu_pcoa.20 <- cmdscale(otu_dist.20, eig = T)
plot(env_fit.20, p.max=0.01, col="red")
plot(env_fit.20, p.max=0.01, col="red")
plot(env_fit.20, p.max=0.01, col="red")
#PCoA plot with fit of environmental vectors
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
plot(env_fit.20, p.max=0.01, col="red")
plot(env_fit.20, p.max=0.05, col="red")
env_fit.20
map.20
with(map.20, levels(site_name))
otu_pcoa.20
scl <- 20
colvec <- c("red", "blue", "yellow", "green", "violet", "orange", "darkblue", "black", "bisque", "cyan", "azure", "chartreuse",
"khaki", "brown","aquamarine", "chocolate", "cornflowerblue", "darkgreen", "darkolivegreen", "burlywood")
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), scaling=scl)
otu_dist.20
warnings()
otu_dist.20 <- vegdist(t(otu_even28k), method = 'bray')
otu_dist.20
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), scaling=scl)
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
pcoa_plot.20
with(map.20, points(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), display = "sites", col = colvec[Use],
scaling = scl, pch = 21, bg = colvec[Use]))
with(map.20, points(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), display = "sites", col = colvec[site_name],
scaling = scl, pch = 21, bg = colvec[site_name]))
#PCoA plot with fit of environmental vectors
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
with(map.20, points(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), display = "sites", col = colvec[site_name],
scaling = scl, pch = 21, bg = colvec[site_name]))
with(map.20, legend("topright", legend = levels(site_name), bty = "n",
col = colvec, pch = 21, pt.bg = colvec))
with(map.20, legend("topright", legend = levels(site_name), bty = "n",
col = colvec, pch = 21, pt.bg = colvec))
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
with(map.20, points(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), display = "sites", col = colvec[site_name],
scaling = scl, pch = 21, bg = colvec[site_name]))
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
with(map.20, points(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), display = "sites", col = colvec[site_name],
scaling = scl, pch = 21, bg = colvec[site_name]))
with(map.20, legend("topright", legend = levels(site_name), bty = "n",
col = colvec, pch = 21, pt.bg = colvec))
colvec <- c("red", "blue", "yellow", "green", "violet", "orange", "darkblue", "black", "bisque", "cyan", "azure", "chartreuse",
"khaki", "brown","aquamarine", "chocolate", "cornflowerblue", "darkgreen", "darkolivegreen", "burlywood")
colvec <- c("red", "blue", "yellow", "green", "violet", "orange", "darkblue", "black", "bisque", "cyan", "azure", "chartreuse",
"khaki", "brown","aquamarine", "chocolate", "cornflowerblue", "darkgreen", "darkolivegreen", "burlywood")
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
with(map.20, points(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""), display = "sites", col = colvec[site_name],
scaling = scl, pch = 21, bg = colvec[site_name]))
with(map.20, legend("topright", legend = levels(site_name), bty = "n",
col = colvec, pch = 21, pt.bg = colvec))
with(map.20, legend("topright", legend = levels(site_name), bty = "n",
col = colvec, pch = 5, pt.bg = colvec))
with(map.20, legend("topright", legend = levels(site_name), bty = "n",
col = colvec, pch = 0.8, pt.bg = colvec))
plot(otu_pcoa.20, otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
plot(otu_pcoa.20, otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
with(map.20, points(otu_pcoa.20, display = "site_name", col = colvec[site_name],
scaling = scl, pch = 21, bg = colvec[site_name]))
#PCoA plot with fit of environmental vectors
pcoa_plot.20 <- plot(otu_pcoa.20$points[,1], otu_pcoa.20$points[,2], xlab=paste("PCoA1: ",round(ax1.20,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2.20,3)*100,"% var. explained", sep=""))
plot(env_fit.20, p.max=0.05, col="red")
env_fit.20 <- envfit(otu_pcoa.20, env.20, na.rm = TRUE)
env_fit.20
#select most abundant OTUs
hc <- colorRampPalette(c("#91bfdb","white","#fc8d59"), interpolate="linear")
rowS_ordered <- sort(rowSums(otu_even26k), decreasing=TRUE)
otu2 <- otu_even26k[names(rowS_ordered),]
dev.off()
source('http://bioconductor.org/biocLite.R')
biocLite('phyloseq')
library(phyloseq)
#min. number of sequences is ~28K
#subsample to an even number of sequences per sample
otu_even28k <- t(rrarefy(t(otu31_75), min(colSums(otu31_75))))
otu_even28k
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
taxa_otu_table1_20 <- otu_table(taxa_otu_table)[,31:75]
taxa_otu_table1_20
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
otu_even28k_phyl
taxonomy
head(taxonomy)
otu_even28k_taxamerged <- merge_phyloseq(otu_even28k_phyl,tax_table(taxonomy))
otu31_75
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
otu
dim(taxonomy)
otu
otu[,31:75]
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl
otu_even28k_taxamerged <- merge_phyloseq(otu_even28k_phyl,tax_table(otu_even28k_phyl))
otu_even28k_taxamerged <- merge_phyloseq(otu_even28k_phyl,tax_table(otu_even28k))
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
dim(otu)
otu
otu31_75 <- otu[,31:75]
otu31_75
dim(otu31_75)
otu31_75 <- otu[,31:76]
dim(otu31_75)
otu31_75
#summary(otu)
sort(colSums (otu31_75, na.rm = FALSE, dims = 1), decreasing = FALSE)
otu31_75_tax <- otu[,31:76]
otu31_75_tax
otu31_75 <- otu[,-76]
otu31_75 <- otu31_75_tax[,-76]
otu31_75
otu31_75 <- otu31_75_tax[,-76]
otu31_75
otu31_75 <- otu31_75_tax[,-76]
otu31_75
dim(otu31_75)
otu31_75 <- otu31_75_tax[,-46]
otu31_75
dim(otu31_75)
#summary(otu)
sort(colSums (otu31_75, na.rm = FALSE, dims = 1), decreasing = FALSE)
dim(otu31_75)
dim(otu31_75_tax)
otu_even28k_taxamerged <- merge_phyloseq(otu_even28k_phyl,tax_table(otu31_75_tax))
dim(otu_even28k)
tax_table(otu31_75_tax)
taxmat = matrix(taxonomy)
taxmat
rownames(taxmat) <- rownames(otu_even28k)
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
taxmat = matrix(taxonomy)
dim(taxmat)
otu_even28k_tax <- cbind(otu_even28k,taxmat)
otu_even28k_tax
otu_even28k
otu_even28k_tax <- cbind(otu_even28k,taxmat, sep='\t')
otu_even28k_tax
otu_even28k_tax <- cbind(otu_even28k,taxmat)
otu_even28k_tax
taxa_otu_table
otu_even28k_phyl = otu_table(otu_even28k_tax, taxa_are_rows = TRUE)
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
otu <- otu[,-76]
otu_even26k <- t(rrarefy(t(otu), min(colSums(otu))))
otu_even26k_phyl = otu_table(otu_even26k, taxa_are_rows = TRUE)
otu_even26k_phyl
taxmat = matrix(taxonomy)
rownames(taxmat) <- rownames(otu_even28k)
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
names(taxmat)
dim(otu_even28k)
otu_even28k_tax <- cbind(otu_even28k,taxmat)
dim(otu_even28k_tax)
taxmat = matrix(taxonomy)
rownames(taxmat) <- rownames(otu_even28k_tax)
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
colnames(taxmat)
rownames(taxmat) <- rownames(otu_even28k_tax)
taxmat
taxmat = matrix(taxonomy, nrow = nrow(otu_even28k), ncol = 7)
taxmat
rownames(taxmat) <- rownames(otu_even28k)
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
taxmat
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl_tax <- merge_phyloseq(otu_even28k_phyl,tax_table(taxmat))
otu_even28k_phyl_tax
#min. number of sequences is ~28K
#subsample to an even number of sequences per sample
otu_even28k <- t(rrarefy(t(otu31_75), min(colSums(otu31_75))))
sort(colSums (otu_even28k, na.rm = FALSE, dims = 1), decreasing = FALSE)
otu_even28k_phyl_tax
map.20 <- map[31:75,]
map.20
dim(map.20)
# add env map
rownames(map.20) <- map.20$sample_code
map.20_phyl <- sample_data(map.20)
map.20_phyl
# merge otu table, taxonomy, and env map together
otu_even28k_phyl_tax_env <- merge_phyloseq(otu_even28k_phyl_tax,map.20_phyl)
otu_even28k_phyl_tax_env
###Building Plot Bar###
# merge sample by site
phyl.site.merge <- merge_samples(otu_even28k_phyl_tax_env, "site_name")
sample_data(phyl.site.merge)$site_name <- levels(sample_data(otu_even28k_phyl_tax_env)$site_name)
phyl.site.merge <- transform_sample_counts(phyl.site.merge, function(x) 100 * x/sum(x))
phyl.site.merge
rank_names(otu_even28k_phyl_tax_env)
#merge taxa by rank
phyl.site.merge_rank <- tax_glom(phyl.site.merge, taxrank = "Phylum", NArm = FALSE)
phyl.site.merge_rank
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
taxa_otu_table1_20 <- otu_table(taxa_otu_table)[,31:75]
taxa_otu_table1_20.taxamerged <- merge_phyloseq(taxa_otu_table1_20,tax_table(taxa_otu_table))
taxa_otu_table1_20.taxamerged
# add environmental map
rownames(map) <- map$sample_code
phyloseq_map1_20 <- sample_data(map)[31:75,]
phyloseq_map1_20
taxa_otu_table1_20.taxamerged.phyl <- merge_phyloseq(taxa_otu_table1_20.taxamerged,phyloseq_map1_20)
taxa_otu_table1_20.taxamerged.phyl
# relative abundances per
abundance_phyla = tax_glom(taxa_otu_table1_20.taxamerged.phyl, "Phylum")
abundance_phyla
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
#annotate otu table
rownames(map) <- map$sample_code
phyloseq_map <- sample_data(map)
taxa_otu_table_annotated <- merge_phyloseq(taxa_otu_table,phyloseq_map)
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name)
taxa_otu_table_annotated_merge <- transform_sample_counts(taxa_otu_table_annotated_merge, function(x) 100 * x/sum(x))
#change the taxa's rank names
rank_names(taxa_otu_table)
colnames(tax_table(taxa_otu_table)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
colnames(tax_table(taxa_otu_table_annotated_merge)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum", NArm = FALSE)
taxa_otu_table_annotated_merge
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Phylum")
#plot bar
plot_bar(phyl.site.merge_rank, "site_name", fill="Phylum")
rank_names(phyl.site.merge_rank)
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
taxa_otu_table_annotated_merge
phyl.site.merge
#merge taxa by rank
phyl.site.merge_rank <- tax_glom(phyl.site.merge, taxrank = "Phylum")
#change the taxa's rank names
rank_names(otu_even28k_phyl_tax_env)
#change the taxa's rank names
rank_names(otu_even28k_phyl_tax_env)
colnames(tax_table(otu_even28k_phyl_tax_env)) <- c(d = "Domain", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
colnames(tax_table(phyl.site.merge)) <- c(d = "Domain", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
#merge taxa by rank
phyl.site.merge_rank <- tax_glom(phyl.site.merge, taxrank = "Phylum")
phyl.site.merge_rank
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Phylum")
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
#annotate otu table
rownames(map) <- map$sample_code
#annotate otu table
rownames(map) <- map$sample_code
map <- read.table('clean_map_data.csv', sep=',', header=TRUE)
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
taxa_otu_table1_20 <- otu_table(taxa_otu_table)[,31:75]
taxa_otu_table1_20.taxamerged <- merge_phyloseq(taxa_otu_table1_20,tax_table(taxa_otu_table))
taxa_otu_table1_20.taxamerged
# add environmental map
rownames(map) <- map$sample_code
phyloseq_map1_20 <- sample_data(map)[31:75,]
phyloseq_map1_20
taxa_otu_table1_20.taxamerged.phyl <- merge_phyloseq(taxa_otu_table1_20.taxamerged,phyloseq_map1_20)
taxa_otu_table1_20.taxamerged.phyl
# relative abundances per
abundance_phyla = tax_glom(taxa_otu_table1_20.taxamerged.phyl, "Phylum")
colnames(tax_table(taxa_otu_table)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
colnames(tax_table(taxa_otu_table_annotated_merge)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
# relative abundances per
abundance_phyla = tax_glom(taxa_otu_table1_20.taxamerged.phyl, "Phylum")
#change the taxa's rank names
rank_names(taxa_otu_table)
colnames(tax_table(taxa_otu_table)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
otu_even28k_phyl_tax_env
# merge otu table, taxonomy, and env map together
otu_even28k_phyl_tax_env <- merge_phyloseq(otu_even28k_phyl_tax,map.20_phyl)
# merge otu table and taxonomy
otu_even28k_phyl_tax <- merge_phyloseq(otu_even28k_phyl,tax_table(taxmat))
# add rarefied otu table into phyloseq object
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
#min. number of sequences is ~28K
#subsample to an even number of sequences per sample
otu_even28k <- t(rrarefy(t(otu31_75), min(colSums(otu31_75))))
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
map <- read.table('clean_map_data.csv', sep=',', header=TRUE)
head(otu)
dim(otu)
taxonomy <- otu[,'taxonomy']
taxonomy
otu31_75_tax <- otu[,31:76]
otu31_75_tax
otu31_75 <- otu31_75_tax[,-46]
otu31_75
set.seed(13)
#min. number of sequences is ~28K
#subsample to an even number of sequences per sample
otu_even28k <- t(rrarefy(t(otu31_75), min(colSums(otu31_75))))
otu_even28k
# add rarefied otu table into phyloseq object
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
map <- read.table('clean_map_data.csv', sep=',', header=TRUE)
head(otu)
dim(otu)
taxonomy <- otu[,'taxonomy']
taxonomy
otu <- otu[,-76]
set.seed(13)
otu_even26k <- t(rrarefy(t(otu), min(colSums(otu))))
otu_even28k_phyl
# add rarefied otu table into phyloseq object
otu_even28k_phyl = otu_table(otu_even26k, taxa_are_rows = TRUE)
otu_even28k_phyl
# add taxonomy into phyloseq object
taxmat = matrix(taxonomy, nrow = nrow(otu_even28k), ncol = 7)
taxmat
rownames(taxmat) <- rownames(otu_even28k)
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
taxmat
sum(otu_even28k)
#min. number of sequences is ~28K
#subsample to an even number of sequences per sample
otu_even28k <- t(rrarefy(t(otu31_75), min(colSums(otu31_75))))
sort(colSums (otu_even28k, na.rm = FALSE, dims = 1), decreasing = FALSE)
sort(colSums (otu_even26k, na.rm = FALSE, dims = 1), decreasing = FALSE)
#summary(otu_even26k)
sum(otu_even26k)
#min. number of sequences is ~28K
#subsample to an even number of sequences per sample
otu_even28k <- t(rrarefy(t(otu31_75), min(colSums(otu31_75))))
sort(colSums (otu_even28k, na.rm = FALSE, dims = 1), decreasing = FALSE)
sum(otu_even28k)
taxonomy
# merge sample by site
phyl.site.merge <- merge_samples(otu_even28k_phyl_tax_env, "site_name")
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
taxa_otu_table1_20 <- otu_table(taxa_otu_table)[,31:75]
taxa_otu_table1_20.taxamerged <- merge_phyloseq(taxa_otu_table1_20,tax_table(taxa_otu_table))
taxa_otu_table1_20.taxamerged
taxa_otu_table1_20 <- otu_table(taxa_otu_table)[,31:75]
taxa_otu_table1_20
dim(taxa_otu_table1_20)
otu_even28k_phyl_tax
# add rarefied otu table into phyloseq object
otu_even28k_phyl = otu_table(otu_even26k, taxa_are_rows = TRUE)
otu_even28k_phyl
# add rarefied otu table into phyloseq object
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl
dim(otu_even28k_phyl)
taxa_otu_table1_20.taxamerged <- merge_phyloseq(taxa_otu_table1_20,tax_table(taxa_otu_table))
taxa_otu_table1_20.taxamerged
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
# add taxonomy into phyloseq object
taxmat = matrix(taxonomy, nrow = nrow(otu_even28k), ncol = 7)
taxmat
head(taxmat)
otu_even28k_phyl_tax
# merge otu table and taxonomy
otu_even28k_phyl_tax <- merge_phyloseq(otu_even28k_phyl,tax_table(taxmat))
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
taxmat
# merge otu table and taxonomy
otu_even28k_phyl_tax <- merge_phyloseq(otu_even28k_phyl,tax_table(taxmat))
# add taxonomy into phyloseq object
taxmat = matrix(taxonomy, nrow = nrow(otu_even28k), ncol = 7)
# add taxonomy into phyloseq object
taxmat = matrix(taxonomy, nrow = nrow(otu_even28k), ncol = 7)
# add taxonomy into phyloseq object
taxmat = matrix(taxonomy, nrow = nrow(otu_even28k), ncol = 7)
rownames(taxmat) <- rownames(otu_even28k)
colnames(taxmat) <- c("Domain", "Phylum", "Class", "Order", "Family", "Genus", "Species")
taxmat
taxa_names(taxmat)
# add rarefied otu table into phyloseq object
otu_even28k_phyl = otu_table(otu_even28k, taxa_are_rows = TRUE)
otu_even28k_phyl
taxmat
tax_table(taxmat)
taxmat
class(otu_even28k_phyl)
class(taxmat)
class(otu_even28k_phyl)
# merge otu table and taxonomy
otu_even28k_phyl_tax <- merge_phyloseq(otu_even28k_phyl,tax_table(taxmat))
otu_even28k_phyl_tax
# add env map
rownames(map.20) <- map.20$sample_code
# add alpha biodiversity into map
map.20 <- map[31:75,]
# add env map
rownames(map.20) <- map.20$sample_code
map.20_phyl <- sample_data(map.20)
map.20_phyl
# merge otu table, taxonomy, and env map together
otu_even28k_phyl_tax_env <- merge_phyloseq(otu_even28k_phyl_tax,map.20_phyl)
otu_even28k_phyl_tax_env
#change the taxa's rank names
rank_names(otu_even28k_phyl_tax_env)
any(taxa_sums(otu_even28k_phyl_tax_env) == 0)
sum(taxa_sums(otu_even28k_phyl_tax_env) == 0)
otu_even28k_phyl_tax
otu_even28k_phyl_tax_env
abundance_phyla = tax_glom(otu_even28k_phyl_tax_env, "Phylum")
# relative abundances per
abundance_phyla = tax_glom(taxa_otu_table1_20.taxamerged.phyl, "Phylum")
##################################################################################################
###Phyloseq object for only 45 samples without Clarksville###
#################################################################################################
taxa_otu_table
taxa_otu_table1_20 <- otu_table(taxa_otu_table)[,31:75]
taxa_otu_table1_20
taxa_otu_table1_20.taxamerged <- merge_phyloseq(taxa_otu_table1_20,tax_table(taxa_otu_table))
taxa_otu_table1_20.taxamerged
# add environmental map
rownames(map) <- map$sample_code
phyloseq_map1_20 <- sample_data(map)[31:75,]
phyloseq_map1_20
taxa_otu_table1_20.taxamerged.phyl <- merge_phyloseq(taxa_otu_table1_20.taxamerged,phyloseq_map1_20)
taxa_otu_table1_20.taxamerged.phyl
# relative abundances per
abundance_phyla = tax_glom(taxa_otu_table1_20.taxamerged.phyl, "Phylum")
abundance_phyla
taxa_otu_table1_20.taxamerged.phyl
otu_even28k_phyl_tax_env
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
#annotate otu table
rownames(map) <- map$sample_code
phyloseq_map <- sample_data(map)
taxa_otu_table_annotated <- merge_phyloseq(taxa_otu_table,phyloseq_map)
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name)
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name)
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum", NArm = FALSE)
#change the taxa's rank names
rank_names(taxa_otu_table)
colnames(tax_table(taxa_otu_table)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum", NArm = FALSE)
colnames(tax_table(taxa_otu_table_annotated_merge)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum", NArm = FALSE)
taxa_otu_table_annotated_merge
otu_even28k_phyl_tax_env
# merge sample by site
phyl.site.merge <- merge_samples(otu_even28k_phyl_tax_env, "site_name")
phyl.site.merge
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
taxa_otu_table_annotated_merge
sample_data(phyl.site.merge)$site_name <- levels(sample_data(otu_even28k_phyl_tax_env)$site_name)
phyl.site.merge <- transform_sample_counts(phyl.site.merge, function(x) 100 * x/sum(x))
phyl.site.merge
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name)
taxa_otu_table_annotated_merge <- transform_sample_counts(taxa_otu_table_annotated_merge, function(x) 100 * x/sum(x))
taxa_otu_table_annotated_merge
phyl.site.merge <- tax_glom(phyl.site.merge, taxrank = "Phylum")
rank_names(phyl.site.merge)
phyl.site.merge <- tax_glom(phyl.site.merge, taxrank = "Domain")
