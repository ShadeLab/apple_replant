stat_summary(fun.y=mean, colour="red", geom="point",
shape=15, size=1,show.legend = FALSE) +
geom_text(data = clay_percent.means, aes(label = round(clay_percent,digits = 2), y = clay_percent + 0.08))
silt_percent.means <- aggregate(silt_percent ~  site_name, map2, mean)
ggplot(data=map2, aes(x=site_name, y=silt_percent, fill=site_name)) + scale_x_discrete(label=abbreviate)+ geom_boxplot() +
stat_summary(fun.y=mean, colour="red", geom="point",
shape=15, size=1,show.legend = FALSE) +
geom_text(data = silt_percent.means, aes(label = round(silt_percent,digits = 2), y = silt_percent + 0.08))
map
dim(map)
otu
dim(otu)
rownames(map) <- map$sample_code
rownames(map)
####20blocks####
otu_even26k <- otu_even26k[rowSums(otu_even26k)>0,]
otu_rare_PA <- 1*(otu_even26k>0)
otu_rare_PA
map.alpha <- melt(map.div, id.vars=c('site_name', 'cultivar', 'rootstock', 'orchard_block_number'), measure.vars=c('Richness', 'Shannon', 'Pielou'))
map.alpha
View(map.alpha)
ggplot(map.alpha.20blocks, aes(y=value, x=site_name)) +
facet_wrap(~variable, scales = 'free_y') +
geom_boxplot()+
geom_point()+
theme(axis.text.x=element_text(angle=90, hjust=1))
otu_dist <- vegdist(t(otu_even26k), method='bray')
otu_dist
otu_pcoa <- cmdscale(otu_dist, eig=T)
env <- map[,c(9,11:22, 24:36)]
env_fit <- envfit(otu_pcoa, env, na.rm=TRUE)
env_fit
library(ggplot2)
library(reshape2)
library(scales)
library(grid)
library(phyloseq)
####20blocks####
otu_dist.31_75 <- vegdist(t(otu_even26k.31_75), method='bray')
otu_dist.31_75
rownames(map) <- map$sample_code
rownames(map)
otu_even26k <- otu_even26k[rowSums(otu_even26k)>0,]
otu_even26k
#annotate otu table
rownames(map) <- map$sample_code
phyloseq_map <- sample_data(map)
phyloseq_map.31_75 <- sample_data(map.31_75)
map.31_75 <- map[31:75,]
rownames(map.31_75) <- map.31_75$sample_code
phyloseq_map.31_75 <- sample_data(map.31_75)
phyloseq_map.31_75 <- sample_data(map.31_75)
phyloseq_map.31_75
rownames_map <- map.31_75$sample_code
rownames_map
phyloseq.merge <- merge_phyloseq(otu_even26k.31_75, map.31_75)
phyloseq.merge <- merge_phyloseq(otu_even26k.31_75, map.31_75)
dim(otu_even26k.31_75)
dim(map.31_75)
phyloseq.merge <- merge_phyloseq(otu_even26k.31_75, map.31_75)
taxa_otu_table
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
otu
otu_even26k <- t(rrarefy(t(otu), min(colSums(otu))))
head(otu_even26k)
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
otu
otu_even26k <- t(rrarefy(t(otu), min(colSums(otu))))
map <- read.table('clean_map_data.csv', sep=',', header=TRUE)
head(otu)
dim(otu)
taxonomy <- otu[,'taxonomy']
taxonomy
otu <- otu[,-76]
otu
dim(otu)
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
rank_names(tax_table)
rank_names(Taxonomy Table)
rank_names(TaxonomyTable)
rank_names(GlobalPatterns)
rank_names(tax_table())
rank_names(taxa_otu_table)
get_taxa_unique(taxa_otu_table, "Rank2")
colnames(tax_table(taxa_otu_table)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
rank_names(taxa_otu_table)
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Phylum")
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
taxa_otu_table_annotated <- merge_phyloseq(taxa_otu_table,phyloseq_map)
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name)
taxa_otu_table_annotated_merge <- transform_sample_counts(taxa_otu_table_annotated_merge, function(x) 100 * x/sum(x))
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Phylum")
phyloseq_map.31_75 <- sample_data(map.31_75)
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Rank2")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum")
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Phylum")
data(taxa_otu_table)
data("enterotype")
data
data("enterotype")
TopNOTUs = names(sort(taxa_sums(taxa_otu_table), TRUE)[1:10])
ent10 = prune_taxa(TopNOTUs, taxa_otu_table)
plot_bar(ent10, "SeqTech", fill = "taxa_otu_table", facet_grid = ~Phylum)
plot_bar(ent10, "site_name", fill = "Phylum", facet_grid = ~Phylum)
ent10 = prune_taxa(TopNOTUs, taxa_otu_table)
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Genus")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Class")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Class")
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum")
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Class")
sample_names(taxa_otu_table)[1:5]
taxa_otu_table
sample_names(taxa_otu_table)[,-1:30]
sample_names(taxa_otu_table)[-1:30,]
sample_names(taxa_otu_table)[-1:30,,]
sample_names(taxa_otu_table)[31:75]
taxa_otu_table.reomove <- sample_names(taxa_otu_table)[31:75]
taxa_otu_table.reomove
myTaxa = names(sort(taxa_sums(taxa_otu_table), decreasing = TRUE)[1:30])
myTaxa
subset_taxa(taxa_otu_table, sample==1:30)
import_qiime(otu_even26k.31_75)
otu1 <- otu_table(otu_even26k.31_75, taxa_are_rows=FALSE)
otu1
otu1 <- otu_table(otu_even26k.31_75, taxa_are_rows=TRUE)
otu1
taxonomy <- otu[,'taxonomy']
taxonomy <- otu[,'taxonomy']
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
map <- read.table('clean_map_data.csv', sep=',', header=TRUE)
head(otu)
taxonomy <- otu[,'taxonomy']
taxonomy
tax1 <- tax_table(taxonomy)
taxon1 <- as.matrix(taxonomy)
taxon1
tax1 <- tax_table(taxon1)
tax1
head(tax1)
taxa_otu_table
otu1
tax1 <- tax_table(otu_even26k.31_75)
tax1 <- tax_table(taxonomy)
taxon1 <- as.matrix(taxonomy)
taxon1
head(taxon1)
sum(taxon1)
tax1 <- tax_table(taxon1)
tax1
head(tax1)
taxon.1 <- observation_metadata(otu_even26k.31_75)
install.packages("devtools")
library(biomformat)
taxon.1 <- observation_metadata(otu_even26k.31_75)
tax1
tax1
tax1
taxa_otu_table
otu1
phyloseq(otu1)
phyloseq(otu1,map.31_75)
most_abundant_taxa <- sort(taxa_sums(taxa_otu_table, TRUE)[1:topN]
most_abundant_taxa <- sort(taxa_sums(taxa_otu_table, TRUE)[1:topN]
ex2 <- prune_taxa(names(most_abundant_taxa), taxa_otu_table)
most_abundant_taxa <- sort(taxa_sums(taxa_otu_table, TRUE)[1:topN])
most_abundant_taxa <- sort(taxa_sums(taxa_otu_table)[1:topN])
taxonomy(taxa_otu_table)
tax_table(taxa_otu_table)
OTU <-  otu_table(taxa_otu_table, taxa_are_rows = TRUE)
OTU
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
taxa_otu_table
taxa_otu_table <- import_biom("/Users/arifinabintarti/Documents/Parent/Data/single_rare.biom")
taxa_otu_table
taxa_otu_table[,31:75]
data(taxa_otu_table)
data(otu_even26k.31_75)
otu_even26k
OTU = otu_table(taxa_otu_table, taxa_are_rows = TRUE)
OTU
data(OTU)
most_abundant_taxa <- sort(taxa_sums(taxa_otu_table), TRUE)[1:topN]
most_abundant_taxa <- sort(taxa_sums(taxa_otu_table), TRUE)[1:10]
most_abundant_taxa
ex2 <- prune_taxa(names(most_abundant_taxa), taxa_otu_table)
ex2
topFamilies <- tax_table(ex2)[, "Family"]
topFamilies <- tax_table(ex2)[, "Family"]
as.matrix(ex2)
topFamilies <- tax_table(ex2)[, "Phylum"]
topFamilies <- tax_table(ex2)[, "Phylum"]
as(topFamilies, "vector")
topFamilies <- tax_table(ex2)[, "Phylum"]
as(topFamilies, "vector")
topFamilies <- tax_table(ex2)[, "Phylum"]
sample_names(taxa_otu_table)[1:5]
phyloseq_map.31_75
GP.chl = subset_taxa(taxa_otu_table, sample==31:75)
sample_names(taxa_otu_table)[1:5]
OTU1 = as(otu_table(taxa_otu_table), "matrix")
OTU1
if(taxa_are_rows(taxa_otu_table)){OTU1 <- t(OTU1)}
OTUdf = as.data.frame(OTU1)
OTUdf
View(OTUdf)
taxa_names(taxa_otu_table)
taxa_otu_table
taxonomy
otu_even26k.31_75
clean_TaxAss_taxonomy(taxonomy, otu_even26k.31_75, remove_bootstrap)
install.packages("OTUtable")
library(OTUtable)
clean_TaxAss_taxonomy(taxonomy, otu_even26k.31_75, remove_bootstrap)
otu_even26k.31_75
clean_TaxAss_taxonomy(taxonomy, otu_even26k.31_75, remove_bootstrap)
taxonomy
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
otu
taxonomy
clean_mothur_taxonomy(taxonomy, otu_even26k.31_75, remove_bootstrap)
clean_mothur_taxonomy(as.matrix(taxonomy), otu_even26k.31_75, remove_bootstrap)
clean_mothur_taxonomy(as.character(taxonomy), otu_even26k.31_75, remove_bootstrap)
otu_even26k.31_75
clean_mothur_taxonomy(as.character(taxonomy), otu_even26k.31_75, remove_bootstrap)
clean_mothur_taxonomy(file=taxonomy, otu_even26k.31_75, remove_bootstrap)
clean_mothur_taxonomy(taxonomy, otu_even26k.31_75, remove_bootstrap)
taxa <- as.matrix(taxonomy)
taxa
rownames(tax) <- rownames(otu_even26k.31_75)
rownames(tax) <- rownames(otu_even26k)
OTU <- as.matrix(otu_even26k)
OTU
rownames(tax) <- rownames(OTU)
taxa_otu_table
taxa_otu_table
tax.subset <- subset_samples(taxa_otu_table, sample_names(taxa_otu_table)=="C01", "CP02", "C03")
tax.subset <- subset_samples(taxa_otu_table, sample_names(taxa_otu_table)=="C01", "CP02", "C03")
tax.subset <- subset_samples(taxa_otu_table, SampleType=="C01")
dev.off()
tax.subset <- subset_samples(taxa_otu_table, SampleType=="C01")
taxa_otu_table
tax.subset <- subset_samples(otu_table(taxa_otu_table), SampleType=="C01"))
tax.subset <- subset_samples(otu_table(taxa_otu_table), SampleType=="C01")
head(otu_table(taxa_otu_table))
head(tax_table(taxa_otu_table))
colnames(tax_table(taxa_otu_table)) <- c(k = "Kingdom", p = "Phylum", c = "Class",
o = "Order", f = "Family", g = "Genus", s = "Species")
head(tax_table(taxa_otu_table))
ntaxa(taxa_otu_table)
new_rank <- c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")
colnames(tax_table(taxa_otu_table)) <- new_rank
head(tax_table(taxa_otu_table))
remove.taxa <- c("CO1", "C02", "C03", "C04", "C05", "C06", "C07", "C08", "C09", "C10", "C11", "C12", "C13", "C14", "C15", "C16", "C17", "C18", "C19", "C20", "C21", "C22", "C23", "C24", "C25", "C26", "C27", "C28", "C29", "C30")
remove.taxa <- c("FO1", "F02", "F03", "F04", "F05", "F06", "F07", "F08", "F09", "F10", "F11", "F12", "F13", "F14", "F15", "F16", "F17", "F18", "F19", "F20", "F21", "F22", "F23", "F24", "F25", "F26", "F27", "F28", "F29", "F30", "F31", "F32", "F33", "F34", "F35", "F36", "F37", "F38", "F39", "F40", "F41", "F42", "F43", "F44", "F45")
prune_taxa(remove.taxa, taxa_otu_table)
prune_taxa(remove.taxa, taxa_otu_table)
head(otu_table(taxa_otu_table))
keep.taxa <- c("FO1", "F02", "F03", "F04", "F05", "F06", "F07", "F08", "F09", "F10", "F11", "F12", "F13", "F14", "F15", "F16", "F17", "F18", "F19", "F20", "F21", "F22", "F23", "F24", "F25", "F26", "F27", "F28", "F29", "F30", "F31", "F32", "F33", "F34", "F35", "F36", "F37", "F38", "F39", "F40", "F41", "F42", "F43", "F44", "F45")
prune_taxa(keep.taxa, taxa_otu_table)
prune_taxa(keep.taxa, otu_table(taxa_otu_table))
head(tax_table(taxa_otu_table))
newPhyloObject = subset_samples(taxa_otu_table, sampleID != "C01")
newPhyloObject = subset_samples(taxa_otu_table, sampleID != "C01")
otu
otu_table(otu)
taxa_otu_table
data("GlobalPatterns")
GlobalPatterns
sample_names(taxa_otu_table)
newPhyloObject = subset_samples(taxa_otu_table, sample_names(taxa_otu_table) != "C01")
allsamples = sample.names(taxa_otu_table)
allsamples = sample_names(taxa_otu_table)
allsamples
remove.samples = c("CO1", "C02", "C03", "C04", "C05", "C06", "C07", "C08", "C09", "C10", "C11", "C12", "C13", "C14", "C15", "C16", "C17", "C18", "C19", "C20", "C21", "C22", "C23", "C24", "C25", "C26", "C27", "C28", "C29", "C30")
allsamples = sample_names(taxa_otu_table)
allsamples <- allsamples[!(allsamples %in% remove.samples)]
newsamples = prune_samples(mysamples, taxa_otu_table)
allsamples = sample_names(taxa_otu_table)
allsamples
allsamples <- allsamples[!(allsamples %in% remove.samples)]
allsamples
keep.taxa <- c("FO1", "F02", "F03", "F04", "F05", "F06", "F07", "F08", "F09", "F10", "F11", "F12", "F13", "F14", "F15", "F16", "F17", "F18", "F19", "F20", "F21", "F22", "F23", "F24", "F25", "F26", "F27", "F28", "F29", "F30", "F31", "F32", "F33", "F34", "F35", "F36", "F37", "F38", "F39", "F40", "F41", "F42", "F43", "F44", "F45")
badTaxa = c("bad1", "bad2", "bad3")
allTaxa = taxa_names(GlobalPatterns)
allTaxa <- allTaxa[!(allTaxa %in% badTaxa)]
ex1 = prune_taxa(keep.taxa, GlobalPatterns)
ex1 = prune_taxa(keep.taxa, GlobalPatterns)
taxa_otu_table_annotated <- merge_phyloseq(taxa_otu_table,phyloseq_map)
#annotate otu table
rownames(map) <- map$sample_code
phyloseq_map <- sample_data(map)
taxa_otu_table_annotated <- merge_phyloseq(taxa_otu_table,phyloseq_map)
#plot bar
plot_bar(taxa_otu_table_annotated_merge, "site_name", numberOfTaxa = 5, fill="Phylum")
#plot bar
p <- plot_composition(taxa_otu_table_annotated_merge, "Kingdom", "Bacteria", "Phylum", numberOfTaxa = 5, fill = "Phylum")
data("enterotype")
enterotype
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
taxa_otu_table_annotated_merge
#annotate otu table
rownames(map) <- map$sample_code
phyloseq_map <- sample_data(map)
taxa_otu_table_annotated <- merge_phyloseq(taxa_otu_table,phyloseq_map)
#merge sample by site
taxa_otu_table_annotated_merge <- merge_samples(taxa_otu_table_annotated, "site_name")
sample_data(taxa_otu_table_annotated_merge)$site_name <- levels(sample_data(taxa_otu_table_annotated)$site_name)
taxa_otu_table_annotated_merge <- transform_sample_counts(taxa_otu_table_annotated_merge, function(x) 100 * x/sum(x))
#merge taxa by rank
taxa_otu_table_annotated_merge <- tax_glom(taxa_otu_table_annotated_merge, taxrank = "Phylum")
plot_bar(taxa_otu_table_annotated_merge, "site_name", fill="Phylum")
TopNOTUs <- names(sort(taxa_sums(taxa_otu_table_annotated_merge), TRUE)[1:10])
ent10   <- prune_taxa(TopNOTUs, taxa_otu_table_annotated_merge)
plot_bar(ent10, "site_name", fill="Phylum", facet_grid=~Phylum)
plot_bar(ent10, "site_name", fill="Phylum", facet_grid=~Class)
plot_bar(ent10, "site_name", fill="Phylum", facet_grid=~Phylum)
plot_bar(ent10, "site_name", fill="Phylum", facet_grid=~Genus)
#Example of a loop for Fina
install.packages(c('vegan', 'tidyverse'))
install.packages(c("vegan", "tidyverse"))
#install.packages('reshape')
#source("https://bioconductor.org/biocLite.R")
#biocLite()
library(vegan)
library(dplyr)
library(tidyr)
library(ggplot2)
library(reshape)
install.packages('reshape')
install.packages("reshape")
source("https://bioconductor.org/biocLite.R")
biocLite()
setwd('/Users/arifinabintarti/Documents/apple_replant/')
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
setwd('/Users/arifinabintarti/Documents/Parent/apple_replant/')
otu <- read.table('otu_table_v2.txt', sep='\t', header=T, row.names = 1)
map <- read.table('clean_map_data.csv', header=TRUE, sep=",")
head(otu)
dim(otu)
taxonomy <- otu[,'taxonomy']
otu <- otu[,-76]
set.seed(13)
#summary(otu)
#min. number of sequences is ~26K
#subsample to an even number of sequences per sample
otu_even26k <- t(rrarefy(t(otu), min(colSums(otu))))
head(otu_even26k)
otu_even26k <- otu_even26k[rowSums(otu_even26k)>0,]
otu_rare_PA <- 1*(otu_even26k>0)
s <- specnumber(otu_even26k, MARGIN = 2)
h <- diversity(t(otu_even26k), index = 'shannon')
pielou <- h/log(s)
map.div <- map
block=unique(map[,"site_name"])
for (i in 1:length(block)){
#subset the OTU table to only include those blocks
temp=otu_even26k[,map[,"site_name"]==block[i]]
#how many samples in this block?
samples=ncol(temp)
#how many total sequences in the whole dataset?
totalseq=sum(temp)
#what is the number of sequences per OTU?
r=rowSums(temp)
#sort the otus by abundance, with the most abundant first
s=sort(r, decreasing=TRUE, index.return=TRUE)
#using the returned index from the sort (s$ix), sort the dataset with the most abundant OTU first
temp.s=temp[s$ix,]
#pull out the top ten
temp.10=temp.s[1:10,]
#what is the cumulative contribution of the top ten OTUs?
cumulcontri=sum(temp.10)/totalseq
print(cumulcontri)
#who are these top 10 OTUs?
names=row.names(temp.10)
id=NULL
for(j in 1:length(names)){
id.temp=tax[grep(names[j],tax[,1]),]
id=rbind(id, id.temp)
}
colnames(id)=c("otuID", "SilvaTaxonomy")
write.table(id, file= paste(block[i],".txt", sep=""),sep="\t", quote=FALSE)
#vector for output data
out=c(samples,cumulcontri)
}
map.div <- map
block=unique(map[,"site_name"])
block
for (i in 1:length(block)){
#subset the OTU table to only include those blocks
temp=otu_even26k[,map[,"site_name"]==block[i]]
#how many samples in this block?
samples=ncol(temp)
#how many total sequences in the whole dataset?
totalseq=sum(temp)
#what is the number of sequences per OTU?
r=rowSums(temp)
#sort the otus by abundance, with the most abundant first
s=sort(r, decreasing=TRUE, index.return=TRUE)
#using the returned index from the sort (s$ix), sort the dataset with the most abundant OTU first
temp.s=temp[s$ix,]
#pull out the top ten
temp.10=temp.s[1:10,]
#what is the cumulative contribution of the top ten OTUs?
cumulcontri=sum(temp.10)/totalseq
print(cumulcontri)
#who are these top 10 OTUs?
names=row.names(temp.10)
id=NULL
for(j in 1:length(names)){
id.temp=tax[grep(names[j],tax[,1]),]
id=rbind(id, id.temp)
}
colnames(id)=c("otuID", "SilvaTaxonomy")
write.table(id, file= paste(block[i],".txt", sep=""),sep="\t", quote=FALSE)
#vector for output data
out=c(samples,cumulcontri)
}
map2 <-
block=unique(map[,"site_name"])
View(map)
map2 <- map[, 1:55, 58:65, 68:75]
map2 <- map[, 1:55, 58:65, 68:75]
env=map[,c(9,11:22, 24:36)]
View(env)
map2 <- map[,c(1:55, 58:65, 68:75)]
map
dim(map)
map2 <- map[c(1:55, 58:65, 68:75),]
map2
View(map2)
block=unique(map2[,"site_name"])
for (i in 1:length(block)){
#subset the OTU table to only include those blocks
temp=otu_even26k[,map2[,"site_name"]==block[i]]
#how many samples in this block?
samples=ncol(temp)
#how many total sequences in the whole dataset?
totalseq=sum(temp)
#what is the number of sequences per OTU?
r=rowSums(temp)
#sort the otus by abundance, with the most abundant first
s=sort(r, decreasing=TRUE, index.return=TRUE)
#using the returned index from the sort (s$ix), sort the dataset with the most abundant OTU first
temp.s=temp[s$ix,]
#pull out the top ten
temp.10=temp.s[1:10,]
#what is the cumulative contribution of the top ten OTUs?
cumulcontri=sum(temp.10)/totalseq
print(cumulcontri)
#who are these top 10 OTUs?
names=row.names(temp.10)
id=NULL
for(j in 1:length(names)){
id.temp=tax[grep(names[j],tax[,1]),]
id=rbind(id, id.temp)
}
colnames(id)=c("otuID", "SilvaTaxonomy")
write.table(id, file= paste(block[i],".txt", sep=""),sep="\t", quote=FALSE)
#vector for output data
out=c(samples,cumulcontri)
}
map3 <- map[c(56:57, 66:67),]
block=unique(map3[,"site_name"])
for (i in 1:length(block)){
#subset the OTU table to only include those blocks
temp=otu_even26k[,map3[,"site_name"]==block[i]]
#how many samples in this block?
samples=ncol(temp)
#how many total sequences in the whole dataset?
totalseq=sum(temp)
#what is the number of sequences per OTU?
r=rowSums(temp)
#sort the otus by abundance, with the most abundant first
s=sort(r, decreasing=TRUE, index.return=TRUE)
#using the returned index from the sort (s$ix), sort the dataset with the most abundant OTU first
temp.s=temp[s$ix,]
#pull out the top ten
temp.10=temp.s[1:10,]
#what is the cumulative contribution of the top ten OTUs?
cumulcontri=sum(temp.10)/totalseq
print(cumulcontri)
#who are these top 10 OTUs?
names=row.names(temp.10)
id=NULL
for(j in 1:length(names)){
id.temp=tax[grep(names[j],tax[,1]),]
id=rbind(id, id.temp)
}
colnames(id)=c("otuID", "SilvaTaxonomy")
write.table(id, file= paste(block[i],".txt", sep=""),sep="\t", quote=FALSE)
#vector for output data
out=c(samples,cumulcontri)
}
